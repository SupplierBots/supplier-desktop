!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(e,t){e.exports=require("electron")},function(e,t){e.exports=require("ramda")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("puppeteer-extra")},function(e,t){e.exports=require("electron-better-ipc")},function(e,t){e.exports=require("electron-is-dev")},function(e,t){e.exports=require("fs-extra")},function(e,t){e.exports=require("puppeteer/DeviceDescriptors")},function(e,t){e.exports=require("puppeteer-extra-plugin-stealth")},function(e,t){e.exports=require("cheerio")},function(e,t){e.exports=require("request-promise-native")},function(e,t){e.exports=require("electron-devtools-installer")},function(e,t,n){"use strict";n.r(t);var o=n(0),s=n(2),r=n.n(s),a=n(5),i=n.n(a),c=n(4),l=n(6),u=n.n(l),p=n(3),d=n.n(p);const h=async e=>{const t=o.app.getPath("userData"),n=r.a.resolve(t,".local-chromium");try{u.a.accessSync(n);const e=d.a.createBrowserFetcher({path:n});if((await e.localRevisions()).length<1)return!1;const t=e.revisionInfo("662092").executablePath,o=await d.a.launch({executablePath:t,headless:!1}),s=await o.newPage();return await s.goto("https://www.google.com/"),await o.close(),{success:!0,executablePath:t}}catch(e){return console.log("Error while testing browser."),console.log(e),u.a.removeSync(n),{success:!1,executablePath:"fail"}}},f=e=>{const t=r.a.resolve(o.app.getPath("userData"),".local-chromium"),n=d.a.createBrowserFetcher({path:t});let s=0;n.download("662092",async(e,t)=>{const n={progress:Math.round(e/t*100),done:e===t};(n.progress>s||n.done)&&(s=n.progress,null==L||L.webContents.send("CHROMIUM_DOWNLOAD_PROGRESS",n))})};var w=n(7),g=n.n(w),m=n(8),v=n.n(m);var b=async(e,t=0)=>{null==L||L.webContents.send("BROWSER_STATE_CHANGE",{id:e,status:!0});const n=o.app.getPath("userData"),s=d.a.createBrowserFetcher({path:r.a.resolve(n,".local-chromium")}).revisionInfo("662092").executablePath,a=r.a.resolve(n,e),{width:i,height:c,deviceScaleFactor:l}=g.a["Pixel 2"].viewport;d.a.use(v()());const u=await d.a.launch({headless:!1,devtools:!1,ignoreHTTPSErrors:!0,ignoreDefaultArgs:["--enable-automation"],args:["--disable-infobars","--no-first-run","--enable-features=NetworkService",`--user-data-dir=${a}`,`--window-size=${i},${c+82}`,`--window-position=${0+500*t},0`],executablePath:s}),p=await u.newPage(),h=await p.target().createCDPSession();return h.send("Network.setUserAgentOverride",{userAgent:"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3803.0 Mobile Safari/537.36",locale:"en-US,en",platform:"linux"}),await Promise.all([h.send("Emulation.setDeviceMetricsOverride",{mobile:!0,width:i,height:c,deviceScaleFactor:l,screenOrientation:{angle:0,type:"portraitPrimary"}}),h.send("Emulation.setTouchEmulationEnabled",{enabled:!0}),h.send("Emulation.setEmitTouchEventsForMouse",{enabled:!0,configuration:"desktop"})]),p.on("close",async()=>{await u.close()}),u.on("disconnected",async()=>{null==L||L.webContents.send("BROWSER_STATE_CHANGE",{id:e,status:!1})}),u};var y=n(1),P=n(9),x=n.n(P),E=n(10),S=n.n(E);const O={accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9","accept-encoding":"gzip, deflate, br","accept-language":"en-GB,en-US;q=0.9,en;q=0.8","sec-fetch-mode":"navigate","sec-fetch-site":"none","upgrade-insecure-requests":"1","user-agent":"Mozilla/5.0 (Linux; Android 8.0; Pixel 2 Build/OPD3.170816.012) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3803.0 Mobile Safari/537.36"},_=async(e,t=!1)=>{try{const n=await S.a.get(e,{headers:O,timeout:3e3,encoding:"utf-8",gzip:!0});return t?JSON.parse(n):n}catch(t){return console.log(t),_(e)}};var M=_;const T=(e,t=0)=>{let n,o=null,s=!1;const r=()=>{s=!1,n=Date.now()},a=(a=!1,i=!1)=>((null===o||!s&&i||!s&&a&&(isNaN(n)||Date.now()-n>t))&&(s=!0,o=e(),o.then(r).catch(r)),o);return{get:()=>a(!1),refresh:()=>a(!0),forceRefresh:()=>a(!1,!0)}};var U=class{constructor(e){this.url=e,this.variantsFetcher=T(async()=>(await M(this.url,!0)).variants.filter(e=>e.available).map(e=>({id:e.id,name:e.public_title.toLowerCase()})))}};const R=(e,t)=>{if(e=e.toLowerCase(),!y.all(y.includes(y.__,e))(t.positive))return!1;if(y.any(y.includes(y.__,e))(t.negative))return!1;if(!t.multi)return!0;for(const n of t.multi){const t=n.split(" | ");if(y.none(y.includes(y.__,e))(t))return!1}return!0};let C;!function(e){e[e.Us=0]="Us",e[e.Eu=1]="Eu"}(C||(C={}));var q=class{get websiteUrl(){return`https://shop${this.region===C.Eu?"":"-usa"}.palaceskateboards.com/`}constructor(e){this.region=e,this.products=[],this.productsPerPage=30,this.frontpageStatusUrl=`${this.websiteUrl}collections/frontpage.json`,this.productsStatusUrl=`${this.websiteUrl}collections/new.json`,this.frontpageUrl=`${this.websiteUrl}collections/frontpage?page=`,this.productsUrl=`${this.websiteUrl}collections/new?page=`,this.fetchPromise=null,this.fetchProducts=T(async()=>{const e=await this.getProductsAmount(),t=Math.ceil(e/this.productsPerPage);this.products=[];const n=[];for(let e=1;e<t+1;e++)n.push(this.requestPage(e,!0));return this.fetchPromise=Promise.all(n),await this.fetchPromise,this.products}),this.getProductsAmount=async()=>{const e=(await M(this.productsStatusUrl,!0)).collection.products_count;return e>0?e:(await M(this.frontpageStatusUrl,!0)).collection.products_count},this.requestPage=async(e,t=!1)=>{const n=(t?this.frontpageUrl:this.productsUrl)+e,o=await M(n),s=x.a.load(o),r=s(".product-grid-item");this.parseProductsHtml(s,r)},this.getProductFetcher=async({keywords:e,colors:t,anyColor:n})=>{await this.fetchProducts.get();const o=this.products.find(o=>R(o.name,e)&&(R(o.name,t)||n));return o?(o.fetcher||(o.fetcher=new U(o.url)),o.fetcher.variantsFetcher):null},this.parseProductsHtml=(e,t)=>{t.each((t,n)=>{const o=n.attribs["data-alpha"],s=`${this.websiteUrl+e(n).find(".product-link").attr("href")}.js`;this.products.push({name:o,url:s})})}}};const A=async(e,t,n)=>{const o=await e.pages(),s=y.last(o);if(!s)return;const r=await s.cookies("https://shop.palaceskateboards.com/");async function a(e){const t=await n.eu.getProductFetcher(e),o=await(null==t?void 0:t.get()),s=null==o?void 0:o.find(t=>{var n;return t.name===(null===(n=e.size)||void 0===n?void 0:n.value.toLowerCase())});return s?s.id:-1}await s.deleteCookie(...r),await s.goto("https://shop.palaceskateboards.com/cart"),async function(){if(!s)return;let e=[];for(const n of t.products)e.push(a(n));const n=await Promise.all(e),o={updates:{}};n.filter(e=>-1!==e).forEach(e=>o.updates[e.toString()]=1),(await(async(e,t,n)=>{console.log(n);try{return{success:!0,response:await(null==e?void 0:e.evaluate(`(async() => {\n      const response = await fetch(window.location.origin + "${t}", {\n        method: 'POST',\n        body: JSON.stringify(${JSON.stringify(n)}),\n        headers: {\n          'Content-Type': 'application/json',\n        },\n      });\n      return await response.json();\n    })()`))}}catch(e){return{success:!1,response:null}}})(s,"/cart/update.js",o)).success&&await s.reload();setTimeout(async()=>{const e=await s.$(".checkbox-msg");e&&await e.tap()},3e3)}()};class D{constructor(){this.browsers=[]}static getInstance(){var e;return this.instance=null!==(e=this.instance)&&void 0!==e?e:new D,this.instance}async setup(e){try{const t=await b(e.id);this.browsers.push(t);const n=await t.pages(),o=y.last(n);if(!o)return void t.close();(async(e,t)=>{const n=e.browser();e?(await e.goto("https://accounts.google.com/signin/v2/identifier?flowName=GlifWebSignIn&flowEntry=ServiceLogin&hl=en"),e.on("load",async()=>{if(!L)return;if(!e.url().includes("https://myaccount.google.com/"))return;const o=await e.$x("//div[contains(text(),'@gmail.com')]");if(o.length<1)return;const[s]=o;let r=await e.evaluate(e=>e.textContent,s);const a=await c.ipcMain.callRenderer(L,"GET_SAME_EMAILS",r);a.length>0&&(r+=` (${a.length+1})`),c.ipcMain.sendToRenderers("SET_BROWSER_EMAIL",{id:t,email:r}),n.close()})):n.close()})(o,e.id)}catch{}}async startTasks(e){const t={eu:new q(C.Eu),us:new q(C.Us)};e.forEach(async(e,n)=>{var o,s;if(!e.browser)return;const r=await b(null===(o=e.browser)||void 0===o?void 0:o.value,n);this.browsers.push(r),"palace"===(null===(s=e.site)||void 0===s?void 0:s.value)&&A(r,e,t)})}async stopAll(){const e=[];this.browsers.forEach(t=>{t.isConnected()&&e.push(t.close())}),this.browsers=[],await Promise.all(e)}}D.instance=void 0;var $=D;const k=(e,t)=>{$.getInstance().setup(t)};let L;n.d(t,"mainWindow",(function(){return L}));const j=()=>{i.a&&(async()=>{const e=n(11),t=["REACT_DEVELOPER_TOOLS","REDUX_DEVTOOLS"],o=!!process.env.UPGRADE_EXTENSIONS;for(const n of t)try{await e.default(e[n],o)}catch(e){console.log(`Error installing ${n} extension: ${e.message}`)}})();L=new o.BrowserWindow({width:1200,height:750,show:!1,resizable:!1,webPreferences:{nodeIntegration:!0,backgroundThrottling:!1}}),L.loadURL(i.a?"http://localhost:3000":`file://${r.a.join(__dirname,"../build/index.html")}`),L.webContents.once("did-finish-load",()=>{L&&(L.show(),i.a&&(L.webContents.openDevTools(),L.webContents.on("context-menu",(e,t)=>{o.Menu.buildFromTemplate([{label:"Inspect element",click:()=>{L.inspectElement(t.x,t.y)}}]).popup(L)})))}),L.on("closed",()=>L=null),o.ipcMain.on("asynchronous-message",(e,t)=>{e.reply("asynchronous-reply",`Received ${t}!`)})};o.app.on("ready",j),o.app.on("window-all-closed",()=>{"darwin"!==process.platform&&o.app.quit()}),o.app.on("activate",()=>{null===L&&j()}),c.ipcMain.answerRenderer("VERIFY_CHROME",h),o.ipcMain.on("DOWNLOAD_CHROMIUM",f),o.ipcMain.on("SETUP_BROWSER",k)}]);
//# sourceMappingURL=electron.js.map